<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="combined.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <title>挂机模式 - Kyaru</title>
</head>
<body id="idleBody">
    <div class="idle-container">
        <div class="idle-header">
            <h1>挂机模式</h1>
            <button class="back-home-btn" onclick="window.location.href='index.html'">
                <i class="fa fa-arrow-left"></i> 返回主页
            </button>
        </div>

        <div class="clock-display">
            <div id="clockTime"></div>
        </div>

        <div class="idle-controls">
            <button class="change-bg-btn" onclick="changeBackground()">
                <i class="fa fa-image"></i> 更换背景
            </button>
            <button class="mode-btn" onclick="setDayMode()">
                <i class="fa fa-sun"></i> 日间模式
            </button>
            <button class="mode-btn" onclick="setNightMode()">
                <i class="fa fa-moon"></i> 夜间模式
            </button>
            <button class="mode-btn" onclick="setAutoMode()">
                <i class="fa fa-clock"></i> 自动模式
            </button>
        </div>

        <!-- 夜间模式遮罩 -->
        <div id="nightOverlay" class="night-overlay"></div>
    </div>

    <script>
        // 时钟功能
        let clockInterval = null;

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 设置初始背景
            setInitialBackground();

            // 初始化时钟
            setAutoMode();
            getTime();
            clockInterval = setInterval(getTime, 1000);

            // 每小时检查一次模式
            setInterval(setAutoMode, 60 * 60 * 1000);
        });

        function setInitialBackground() {
            const idleBody = document.getElementById('idleBody');
            // 使用API获取随机背景图
            idleBody.style.backgroundImage = `url('https://t.alcy.cc/ycy')`;
            idleBody.style.backgroundSize = 'cover';
            idleBody.style.backgroundPosition = 'center';
            idleBody.style.backgroundRepeat = 'no-repeat';
            idleBody.style.backgroundAttachment = 'fixed';
        }

        function changeBackground() {
            const idleBody = document.getElementById('idleBody');
            // 添加随机参数确保每次获取不同的图片
            const randomParam = Math.random();
            idleBody.style.backgroundImage = `url('https://t.alcy.cc/ycy?r=${randomParam}')`;
        }

        function getTime() {
            var now = new Date();
            var year = now.getFullYear();
            var month = ('0' + (now.getMonth() + 1)).slice(-2);
            var day = ('0' + now.getDate()).slice(-2);
            var hours = ('0' + now.getHours()).slice(-2);
            var minutes = ('0' + now.getMinutes()).slice(-2);
            var seconds = ('0' + now.getSeconds()).slice(-2);

            var element = document.getElementById('clockTime');

            var str = "今天是星期";
            var week = now.getDay();
            var weekStr = ["日", "一", "二", "三", "四", "五", "六"][week];
            str += weekStr;

            element.innerHTML = '<h3>' + year + '-' + month + '-' + day + '</h3>' + 
                '<h1>' + hours + ':' + minutes + ':' + seconds + '</h1>' + 
                '<p>' + str + '</p>';
        }

        function setDayMode() {
            const nightOverlay = document.getElementById('nightOverlay');
            nightOverlay.classList.remove('active');
        }

        function setNightMode() {
            const nightOverlay = document.getElementById('nightOverlay');
            nightOverlay.classList.add('active');
        }

        function setAutoMode() {
            var now = new Date();
            var hours = now.getHours();
            if (hours > 18 || hours < 6) {
                setNightMode();
            } else {
                setDayMode();
            }
        }


    </script>
</body>
</html>